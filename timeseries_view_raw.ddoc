{"views":{"timeseries":{"map":"function (doc, meta) {\n  if (doc._type == 'ForexSpot') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var fromFX = [doc.fromFX];\n      var toFX = [doc.toFX];\n      var source = [doc.source];\n      emit([doc._type].concat(fromFX).concat(toFX).concat(source).concat(realDate), null);\n    }\n  } else if (doc._type == 'ForexForwardSpot') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var fromFX = [doc.fromFX];\n      var toFX = [doc.toFX];\n      var source = [doc.source];\n      emit([doc._type].concat(fromFX).concat(toFX).concat(source).concat(realDate), null);\n    }\n  } else if (doc._type == 'Price') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var instrumentRef = [doc.instrumentRef.$ref];\n      var source = [doc.source];\n      emit([doc._type].concat(instrumentRef).concat(source).concat(realDate), null);\n    }\n  } else if (doc._type == 'Transaction') {\n    var idx;\n    for(idx = 0; idx < doc.details.length; idx++) {\n      var custodyAccount = [doc.details[idx].custodyAccountRef.$ref];\n      var date = doc.details[idx].tradeDate || doc.details[0].tradeDate || doc.ticketDate;\n      var realDate = dateToArray(date).slice(0, 3);\n      emit([doc._type].concat(custodyAccount).concat(realDate), null);\n    }\n  }\n}"}}}