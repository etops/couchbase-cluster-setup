{"views":{"timeseries":{"map":"\n// Version 6\nfunction (doc, meta) {\n  if (doc._type == 'CustodyAccountPosition') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var instrumentRef = [doc.instrumentRef.$ref];\n      var custodyAccountRef = [doc.custodyAccountRef.$ref];\n      if (doc.active) {\n        emit([doc._type].concat(custodyAccountRef).concat(realDate), null);\n        emit([doc._type].concat(instrumentRef).concat(custodyAccountRef).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'PortfolioPosition') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var instrumentRef = [doc.instrumentRef.$ref];\n      var portfolioRef = [doc.portfolioRef.$ref];\n      var namespace = meta.id.split('::')[0];\n      if (doc.active) {\n        emit([doc._type].concat(portfolioRef).concat(realDate), null);\n        emit([doc._type + 'ByInstrument'].concat(namespace).concat(instrumentRef).concat(realDate), null);\n        emit([doc._type].concat(instrumentRef).concat(portfolioRef).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'PortfolioSeries') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var portfolioRef = [doc.portfolioRef.$ref];\n      if (doc.active) {\n        emit([doc._type].concat(portfolioRef).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'ForexSpot') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var fromFX = [doc.fromFX];\n      var toFX = [doc.toFX];\n      if (doc.active) {\n        emit([doc._type].concat(fromFX).concat(toFX).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'ForexForwardSpot') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var fromFX = [doc.fromFX];\n      var toFX = [doc.toFX];\n      if (doc.active) {\n        emit([doc._type].concat(fromFX).concat(toFX).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'Price') {\n    if (!doc.nextRef) {\n      var realDate = dateToArray(doc.realDate).slice(0, 3);\n      var instrumentRef = [doc.instrumentRef.$ref];\n      if (doc.active) {\n        emit([doc._type].concat(instrumentRef).concat(realDate), null);\n      }\n    }\n  } else if (doc._type == 'Transaction') {\n    var idx;\n    for(idx = 0; idx < doc.details.length; idx++) {\n      var custodyAccount = [doc.details[idx].custodyAccountRef.$ref];\n      var date = doc.details[idx].tradeDate || doc.details[0].tradeDate || doc.ticketDate;\n      var realDate = dateToArray(date).slice(0, 3);\n      if (doc.active) {\n        emit([doc._type].concat(custodyAccount).concat(realDate), idx);\n        emit([doc._type + 'ByDetail'].concat(custodyAccount).concat(idx).concat(realDate), idx);\n      }\n    }\n  }\n}"}}}