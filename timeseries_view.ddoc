{"views":{"timeseries":{"map":"function (doc, meta) {\n  if (doc._type == 'CustodyAccountPosition') {\n    var realDate = dateToArray(doc.realDate);\n    var valuedDate = dateToArray(doc.processing.valuedDate);\n    var instrumentRef = [doc.instrumentRef.$ref];\n    var custodyAccountRef = [doc.custodyAccountRef.$ref];\n    emit(instrumentRef.concat(custodyAccountRef).concat(realDate).concat(valuedDate), doc.oid);\n  } else if (doc._type == 'PortfolioPosition') {\n    var realDate = dateToArray(doc.realDate);\n    var valuedDate = dateToArray(doc.processing.valuedDate);\n    var instrumentRef = [doc.instrumentRef.$ref];\n    var portfolioRef = [doc.portfolioRef.$ref];\n    emit(instrumentRef.concat(portfolioRef).concat(realDate).concat(valuedDate), doc.oid);\n  } else if (doc._type == 'PortfolioSeries') {\n    var realDate = dateToArray(doc.realDate);\n    var valuedDate = dateToArray(doc.processing.valuedDate);\n    var portfolioRef = [doc.portfolioRef.$ref];\n    emit(portfolioRef.concat(realDate).concat(valuedDate), doc.oid);\n  } else if (doc._type == 'ForexSpot') {\n    var realDate = dateToArray(doc.realDate);\n    var spotDate = dateToArray(doc.spotDate);\n    var fromFX = [doc.fromFX];\n    var toFX = [doc.toFX];\n    \n    if (!spotDate) {\n  \tspotDate = realDate;\n    }\n    \n    emit(fromFX.concat(toFX).concat(realDate).concat(spotDate), doc.oid);\n  } else if (doc._type == 'Price') {\n    var realDate = dateToArray(doc.realDate);\n    var quotedDate = dateToArray(doc.spotDate);\n    var instrumentRef = [doc.instrumentRef.$ref];\n    \n    if (!quotedDate) {\n    \tquotedDate = realDate;\n    }\n    \n    emit(instrumentRef.concat(realDate).concat(quotedDate), doc.oid);\n  }\n}"}}